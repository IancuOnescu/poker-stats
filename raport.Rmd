---
title: "Raport"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

**TODO:** Chestia asta o sa trebuiasca scrisa cat de cat formal banuiesc

## Procesare dataset
Dataset-ul initial contine 10 milioane de maini din jocuri de poker in format text. Pentru convenienta am transformat toate fisierele in format `feather` aplicand urmatorii pasi:

* `decompress.py` contine codul pentru dezarhivarea fisierelor
* `parse.py` contine codul pentru transformarea din text in CSV
* Creem structura directorului de iesire
```bash
find parsed_data -type d > dirs.txt
sed -i 's/parsed_data/dataframes/g' dirs.txt
xargs mkdir -p < dirs.txt
rm -f dirs.txt
```
* Pentru transformarea din CSV in Feather am utilizat urmatorul cod R din pachetul nostru `PokerStats`:
```{r eval=FALSE}
library(PokerStats)
convert_all_csvs_to_feather("./parsed_data")
```

* Creem un singur fisier doar pentru castiguri pentru a evita procesari multiple inutile:
```{r eval=FALSE}
library(PokerStats)
library(feather)

pdbs = load_pdbs("./dataframes")
data = rbindlist(pdbs)
write_feather(data, "./dataframes/all_hands.feather")

rm(pdbs)
rm(data)
gc()
```

## Repartitie castiguri (draft)

```{r eval=TRUE, cache=TRUE}
library(PokerStats)
library(feather)
library(tictoc)

data = read_feather("./dataframes/all_hands.feather")
plist = players_list(data)
pfreq = player_hands_freq(data)
pstat = player_hands_stats(pfreq)

for (i in seq(10)) {
  tic(sprintf("Evaluate player %d", i))
  plot_player_distr(data, as.character(pfreq$p_name[i]), 10000)
  toc()
}
```

## Legea lui Benford

```{r eval=FALSE}
library(benford.analysis)

# Toate astea par sa respecte legea lui Benford
bf1 = benford(factor_to_int(data$p_pot_sz), number.of.digits = 1)
bf2 = benford(factor_to_int(data$p_bankroll), number.of.digits = 1)
bf3 = benford(factor_to_int(data$win), number.of.digits = 1)

dev.new()
plot(bf1)
dev.new()
plot(bf2)
dev.new()
plot(bf3)
```
